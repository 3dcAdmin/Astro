---
import Prism from 'prismjs';
import { addAstro } from '../astro-prism/index.mjs';
import { loadLanguage } from './prism/preload.mjs';

export let lang;
export let code;

const languageMap = new Map([
  ['ts', 'typescript']
]);

if(lang == null) {
  console.warn('Prism.astro: No language provided.');
}

if(languageMap.has(lang)) {
  await loadLanguage(languageMap.get(lang));
} else if(lang === 'astro') {
  await loadLanguage('typescript');
  addAstro(Prism);
} else {
  await loadLanguage(lang);
}

if(!Prism.languages[lang]) {
  console.warn(`Unable to load the language: ${lang}`);
}

const grammar = Prism.languages[lang];
let html = Prism.highlight(code, grammar, lang);

let className = `language-${lang}`;
---

<pre class={className}><code class={className}>{html}</code></pre>