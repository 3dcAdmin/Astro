---
import type { LocalImageProps, RemoteImageProps } from 'astro:assets';
import { getImage } from 'astro:assets';
import { AstroError, AstroErrorData } from '../dist/core/errors/index.js';

// The TypeScript diagnostic for JSX props uses the last member of the union to suggest props, so it would be better for
// LocalImageProps to be last. Unfortunately, when we do this the error messages that remote images get are complete nonsense
// Not 100% sure how to fix this, seems to be a TypeScript issue. Unfortunate.
type Props = LocalImageProps | RemoteImageProps;

const { loading = 'lazy', decoding = 'async', alt, ...props } = Astro.props;

if (alt === undefined || alt === null) {
	throw new AstroError(AstroErrorData.ImageMissingAlt);
}

const attrs = await getImage(props);
---

<img {...attrs} loading={loading} decoding={decoding} {alt} />
