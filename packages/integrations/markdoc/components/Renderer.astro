---
import type { Config } from '@markdoc/markdoc';
import Markdoc from '@markdoc/markdoc';
import type { AstroInstance } from 'astro';
import { validateComponentsProp } from '../dist/utils.js';
import { ComponentNode, createTreeNode } from './TreeNode.js';

type Props = {
	config: Config;
	stringifiedAst: string;
	components?: Record<string, AstroInstance['default']>;
};

const { stringifiedAst, config, components } = Astro.props as Props;

const ast = Markdoc.Ast.fromJSON(stringifiedAst);
const content = Markdoc.transform(ast, config);

// Will throw if components is invalid
if (components) {
	validateComponentsProp(components);
}
---

<ComponentNode treeNode={createTreeNode(content, components)} />
