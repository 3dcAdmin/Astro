---
// @ts-ignore
import { getImage } from '../src/get-image.js';
import type { ImageMetadata, TransformOptions, OutputFormat } from '../src/index.js';

export interface LocalImageProps extends Omit<TransformOptions, 'src'>, Omit<astroHTML.JSX.ImgHTMLAttributes, 'src' | 'width' | 'height'> {
	src: ImageMetadata | Promise<{ default: ImageMetadata }>;
}

export interface RemoteImageProps extends TransformOptions, astroHTML.JSX.ImgHTMLAttributes {
	src: string;
	format: OutputFormat;
	width: number;
	height: number;
}

export type Props = LocalImageProps | RemoteImageProps;

const { loading = "lazy", decoding = "async", ...props } = Astro.props as Props;

const attrs = await getImage(props);
---

<img {...attrs} {loading} {decoding} />

<style>
	img {
		content-visibility: auto;
	}
</style>
